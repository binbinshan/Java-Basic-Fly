
# 什么是内存泄漏？如果定位内存泄漏？

内存泄漏:程序在申请内存后，无法释放已申请的内存空间
常见泄漏情况:
1. 长生命周期的对象持有短生命周期对象的引用
例如将ArrayList设置为静态变量，则容器中的对象在程序结束之前将不能被释放，从而造成内存泄漏。
1. 连接未关闭
如数据库连接、网络连接和IO连接等，只有连接被关闭后，垃圾回收器才会回收对应的对象。
1. 变量作用域不合理
一个变量的定义的作用范围大于其使用范围；没有及时地把对象设置为null。
1. 内部类持有外部类
Java的非静态内部类的这种创建方式，会隐式地持有外部类的引用，而且默认情况下这个引用是强引用，因此，如果内部类的生命周期长于外部类的生命周期，程序很容易就产生内存泄漏
如果内部类的生命周期长于外部类的生命周期，程序很容易就产生内存泄漏（你认为垃圾回收器会回收掉外部类的实例，但由于内部类持有外部类的引用，导致垃圾回收器不能正常工作）
解决方法：你可以在内部类的内部显示持有一个外部类的软引用(或弱引用)，并通过构造方法的方式传递进来，在内部类的使用过程中，先判断一下外部类是否被回收；
1. Hash值改变
在集合中，如果修改了对象中的那些参与计算哈希值的字段，会导致无法从集合中单独删除当前对象，造成内存泄露


## 如果定位内存泄漏？
1. 使用top查看cpu
2. 使用jstat -gc pid 命令查看 java 进程的 GC 状态
3. 使用jmap -dump:format=b,file=heap.log pid 保存了堆现场
4. 使用 MAT 分析 jvm heap