# MySQL数据库和操作系统之间的交互(五)

### MySQL的两种数据读写机制
MySQL在实际工作时候的两种数据读写机制，一种是对redo log、binlog这种日志进行的磁盘顺序读写，一种是对表空间的磁盘文件里的数据页进行的磁盘随机读写。

1. 随机读写：
    * 随机的位置读取一个数据页到缓存，这就是磁盘随机读写。因为要读取的这个数据页可能在磁盘的任意一个位置，所以读取磁盘里的数据页的时候只能是用随机读的这种方式。

    * 随机读写的效率比较差，这也是为什么需要buffer Poll的原因之一，减少随机读写次数。

1. 顺序读写：
    * 在一个磁盘日志文件里，一直在末尾追加日志。

    * 磁盘顺序写的性能其实是很高的，某种程度上来说，几乎可以跟内存随机读写的性能差不多，尤其是在数据库里也用了os cache机制，就是redo log顺序写入磁盘之前，先是进入os cache，就是操作系统管理的内存缓存里。
    * redo log写的越快，sql性能越高。


### Linux存储系统与 随机读写、顺序读写
Linux利用存储系统去管理机器上的存储设备，如机械硬盘、固态硬盘，这样Mysql就可以进行读写数据。
另外，MySQL执行磁盘随机读写，还是磁盘顺序读写，其实在底层的Linux层面，原理几乎都是一致的。

* Linux的存储系统
    
    ![-w391](https://github.com/binbinshan/Java-Basic-Fly/blob/master/2021-06-09/16229834913607.jpg)

* 读写请求流程
    1. MySQL发起一次数据页的随机读写或顺序读写，实际上会把磁盘IO请求交给 Linux操作系统的VFS层。主要目的就是确认是哪个目录中的文件执行的磁盘IO操作，把IO请求交给具体的文件系统，比如说是查找/xx1这个目录是由NFS文件系统管理的。

    2. 文件系统会先在Page Cache这个基于内存的缓存里寻找数据是否存在，如果有就基于内存缓存来执行读写，如果没有将这个请求交给通用Block层
    3. 通用Block层会把对文件的IO请求转换为Block IO 请求，Block IO请求交给IO调度层。
    4. IO调度层采默认是用CFQ公平调度算法，决定IO请求可以执行，就会交给Block设备驱动层，然后最后经过驱动把IO请求发送给真正的存储硬件，也就是Block设备层。
    5. 最终硬件设备完成读写后，依次向上返回结果。



    




    